#!/usr/bin/env bash

# Remove old containers, volumes, and images
./bin/clean.js

# Start databases and prisma
./bin/manage-db start
./bin/manage-db deploy

# Run docker-compose with development configuration
docker-compose \
  -f ./docker/test/unit/docker-compose.yml up --build \
  --abort-on-container-exit \
  --exit-code-from unit-test

TEST_EXIT_CODE=$?

# Stop databases
./bin/manage-db stop

# Exit script with the code from the test
exit $TEST_EXIT_CODE
