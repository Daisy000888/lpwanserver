#!/usr/bin/env bash

docker container rm dev_lpwanserver_prisma --force
docker container rm dev_lpwanserver_postgres --force
docker volume rm dev_lpwanserver_postgres --force

# Start prisma daemon
docker-compose \
  -f ./prisma/dev/docker-compose.yaml up -d

sleep 5s

cd prisma/dev && prisma deploy && cd ../..

# Run docker-compose with development configuration
docker-compose \
  -f ./docker/docker-compose.unit-test.yml up \
  --abort-on-container-exit \
  --exit-code-from unit-test \
  --build

# Stop prisma daemon
docker-compose \
  -f ./prisma/dev/docker-compose.yaml down